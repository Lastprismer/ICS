## 课程起源
略
## 课程规划
略
## 五个有趣的现实问题

### 问题一、整型不是整数，浮点型不是实数

**例1.1** $x^2\geqslant 0$ 永远成立吗？
* $x$ 为浮点型：成立
* $x$ 为整型：溢出，负数：`Int32`

**例1.2** 是否满足结合律 $(x+y)+z=x+(y+z)$？
* 整型：成立（溢出也成立）
* 浮点型：浮点数精度不同不满足结合律（精度有限）
  * $1e20+(-1e20)+3.14=3.14$
  * $1e20+(-1e20+3.14)=0$

计算机系统中的算数 $\not =$ 数学中的算数
* 整数性质：交换律，分配律，结合律
* 实数性质：单调性（$a\geqslant b, c\geqslant 0,\ then:\ a+c\geqslant b+c$），浮点型运算符合单调性

有些性质在计算机系统中不成立：有限大小，舍入导致精度缺失
计算机中不同数据拥有的特性？

例1.3 判断两个数相等
整型：`a == b`
浮点型：`fabs(a-b) <= eps`



### 问题二、了解汇编 Assembly

* 修复bug
例2.1：比较整型int和非整型unsigned int
```c++
printf("%d", (int)-1 > (unsigned int)10);
```
输出1 (true)：-1在unsigned int下被认为是很大的整数

* 程序性能调优

例2.2 
```c++
void func1 (int* x, int* y)
{
    *x = *x + *y;
    *x = *x + *y;
}
```
和

```c++
void func2 (int* x, int* y)
{
    *x = *x * 2 + *y;
}
```
（存储器引用次数，func1需要6次，func2需要3次，所以func2快）

* 系统软件或嵌入式软件开发

例2.3 （把小段汇编代码加入c代码，访问硬件（处理器）上的周期计数器

* 防范恶意软件或分析第三方软件的安全性

没有源代码的软件：**反汇编**
安全漏洞：缓冲区溢出、内存泄露、非授权内存写入
对反汇编代码进行静态分析

例2.4 gets() 与 fgets()，后者更安全（限制大小）



### 问题三、内存对程序性能的影响至关重要

狭义内存：Random Access Memory 随机访问存储器
非 Random 的例子：磁带（倒带操作等）

* 内存是有限的
  * 必须合理分配、管理内存
  * 很多程序受限于内存

* 内存引用错误尤为严重
  * 错误的危害因时间、空间而异

* 内存性能并不是始终如一的
  * 高速缓存和虚拟内存极大地影响程序内存
  * 根据存储系统的特点，可以对程序进行调优

内存引用错误：
```c++
typedef struct
{
    int a[2];
    double d;
} struct_t;

double fun (int i)
{
    volatile struct_t s;
    // volatile 关键字：每次读、取须直接在原始的内存对应位置读、取
    s.d = 3.14;
    s.a[i] = 1141919810; // 超出数组
    return s.d; // 自己去试试
}
```
解释：
内存是栈，改到了其他的位置

* C/C++没有提供对此类错误的防范机制

  * 指针
  * 滥用malloc / free

  * 等等

  

### 问题四、算法性能分析结果 $\not =$ 实际程序性能

* 代码写得好坏与否，可能导致程序性能的数量级差别
* 算法性能优化的多个层面：算法、数据表达、过程、循环
* 只有理解了系统才能进行有效优化

内存性能影响程序性能：
问题：复制矩阵
```c++
void copyij (int src[2048][2048], int dst[2048][2048])
{
    // 从行到列
    int i, j;
    for (int i = 0; i < 2048; i++)
        for (int j = 0; j < 2048; i++)
            dst[i][j] = src[i][j];
}
// 耗时：4.3ms

void copyji (int src[2048][2048], int dst[2048][2048])
{
    // 从列到行
    int i, j;
    for (int j = 0; j < 2048; i++)
        for (int i = 0; i < 2048; i++)
            dst[i][j] = src[i][j];

}
// 耗时：81.8ms
```

* 内存是分层组织的
* 程序性能取决于内存访问模式
  * 例如：如何访问内存中的二维数组、多维数组
* （The memory mountain）
* “内存是王道”？小程序，可维护性更重要！



### 问题五、计算机网络环境下的新问题

* 计算机需要输入和输出数据（键盘、鼠标极为复杂，各为系统）

  * 程序执行前，需要输入数据

  * 程序执行后，需要输出数据

  * 在**网络环境**下，数据输入来源

    * 本地磁盘

    * 网络中别的计算机。例如，利用上传数据到服务器，利用服务器的超强计算能力做仿真实验

      

* I/O 系统对程序稳定性和性能至关重要

  * 如果缺少 I/O 异常处理能力，就会出现程序运行错误

  一、程序与数据
    lab1：位运算实现
    lab2：拆解二进制炸弹
    lab3：缓冲区溢出实验

  二、处理器体系结构和程序性能
    lab4：处理器结构试验

  三、分级存储器体系
    lab5：性能优化实验

  四、异常控制流
    lab6：定制shell程序实验

  五、虚拟内存
    lab7：动态内存管理实验

  六、网络和并发
    lab8：Web代理实验